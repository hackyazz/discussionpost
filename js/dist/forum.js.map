{"version":3,"file":"forum.js","mappings":"mBAAA,MAAM,EAA+BA,OAAOC,KAAKC,OAAO,aCAlD,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,uCCAnBF,OAAOC,KAAKC,OAAO,oBCsBxDC,EAAAA,aAAiBC,IAAI,uBAAuB,WAC1CC,QAAQC,IAAI,6CAEZC,EAAAA,EAAAA,QAAOC,EAAAA,UAA8B,aAAa,SAASC,GACzD,IAAMC,EAAaC,KAAKC,MAAMF,WAC9B,GAAIA,EAAJ,CACA,IAAMG,EAAYH,EAAWG,YAC7B,GAAIA,EAAJ,CACA,IAvBsBC,EAGlBC,EACAC,EAoBEC,GAxBgBH,EAuBND,EAAUK,cApBtBH,GAFS,IAAII,WACAC,gBAAgBN,EAAY,aACvBO,iBAAiB,OACnCL,EAAU,GAEhBD,EAAYO,SAAQ,SAAAC,GACdA,EAAIC,KACNR,EAAQS,KAAKF,EAAIC,IAErB,IAEOR,GAcmB,GAArBC,EAAWS,QAEdjB,EAAML,IAAI,YACRuB,EAAA,KAAGC,UAAU,aACVX,EAAWY,KAAI,SAACL,GACf,GAAGA,EAAIM,SAAS,iBACd,OAAOH,EAAA,OAAKI,MAAM,gBAAgBP,IAAKA,EAAKQ,QAAQ,QAExD,KAZoF,MAAxEvB,EAAML,IAAI,YAAauB,EAAA,KAAGC,UAAU,aAAY,eAF8B,MAA7EnB,EAAML,IAAI,YAAauB,EAAA,KAAGC,UAAU,aAAY,mBAiBnE,GAEF,IAAI,G","sources":["webpack://@yazz/discussionpost/external root \"flarum.core.compat['forum/app']\"","webpack://@yazz/discussionpost/external root \"flarum.core.compat['common/extend']\"","webpack://@yazz/discussionpost/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@yazz/discussionpost/external root \"flarum.core.compat['common/Component']\"","webpack://@yazz/discussionpost/./src/forum/index.js"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport PostImage from './PostImage';\n\n// export { default as extend } from './extend';\n\nfunction extractImageSrcs(htmlString) {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(htmlString, 'text/html');\n  const imgElements = doc.querySelectorAll('img');\n  const srcList = [];\n\n  imgElements.forEach(img => {\n    if (img.src) {\n      srcList.push(img.src);\n    }\n  });\n\n  return srcList;\n}\n\napp.initializers.add('yazz-discussionpost', () => {\n  console.log('[yazz/discussionpost] Hello, forum11111!');\n\n  extend(DiscussionListItem.prototype, \"mainItems\", function(items) {\n    const discussion = this.attrs.discussion;\n    if(!discussion) {items.add(\"postimage\", <p className='PostImage'>discussion属性不存在</p>); return;}\n    const firstPost = discussion.firstPost();\n    if(!firstPost) {items.add(\"postimage\", <p className='PostImage'>firstpost为空</p>);return;}\n    const content = firstPost.contentHtml();\n    const imgSrcList = extractImageSrcs(content);\n\n    if(imgSrcList.length == 0) return;\n\n    items.add('postimage',\n      <p className='PostImage'>\n        {imgSrcList.map((src) => {\n          if(src.includes(\"assets/files/\")) {\n            return <img style='width: 200px;' src={src} loading='lazy' />\n          }\n        })}\n      </p>\n    );\n  })\n\n}, -10);"],"names":["flarum","core","compat","app","add","console","log","extend","DiscussionListItem","items","discussion","this","attrs","firstPost","htmlString","imgElements","srcList","imgSrcList","contentHtml","DOMParser","parseFromString","querySelectorAll","forEach","img","src","push","length","m","className","map","includes","style","loading"],"sourceRoot":""}