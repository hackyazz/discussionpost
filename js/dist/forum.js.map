{"version":3,"file":"forum.js","mappings":"mBAAA,MAAM,EAA+BA,OAAOC,KAAKC,OAAO,aCAlD,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,uCCAnBF,OAAOC,KAAKC,OAAO,oBCsBxDC,EAAAA,aAAiBC,IACf,uBACA,WACEC,QAAQC,IAAI,6CAEZC,EAAAA,EAAAA,QAAOC,EAAAA,UAA8B,aAAa,SAAUC,GAC1D,IAAMC,EAAaC,KAAKC,MAAMF,WAC9B,GAAKA,EAAL,CAIA,IAAMG,EAAYH,EAAWG,YAC7B,GAAKA,EAAL,CAIA,IA/BoBC,EAGlBC,EACAC,EA4BIC,GAhCcH,EA+BJD,EAAUK,cA5BxBH,GAFS,IAAII,WACAC,gBAAgBN,EAAY,aACvBO,iBAAiB,OACnCL,EAAU,GAEhBD,EAAYO,SAAQ,SAACC,GACfA,EAAIC,KACNR,EAAQS,KAAKF,EAAIC,IAErB,IAEOR,GAsBsB,GAArBC,EAAWS,QAEfjB,EAAML,IACJ,YACAuB,EAAA,KAAGC,UAAU,mBACVX,EAAWY,MAAM,EAAE,GAAGC,KAAI,SAACN,GAC1B,GAAIA,EAAIO,SAAS,iBACf,OAAOJ,EAAA,OAAKC,UAAU,YAAYJ,IAAKA,EAAKQ,QAAQ,QAExD,KAbJ,MAFEvB,EAAML,IAAI,YAAauB,EAAA,KAAGC,UAAU,aAAY,eAHlD,MAFEnB,EAAML,IAAI,YAAauB,EAAA,KAAGC,UAAU,aAAY,mBAuBpD,GACF,IACC,G","sources":["webpack://@yazz/discussionpost/external root \"flarum.core.compat['forum/app']\"","webpack://@yazz/discussionpost/external root \"flarum.core.compat['common/extend']\"","webpack://@yazz/discussionpost/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@yazz/discussionpost/external root \"flarum.core.compat['common/Component']\"","webpack://@yazz/discussionpost/./src/forum/index.js"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport PostImage from './PostImage';\n\n// export { default as extend } from './extend';\n\nfunction extractImageSrcs(htmlString) {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(htmlString, 'text/html');\n  const imgElements = doc.querySelectorAll('img');\n  const srcList = [];\n\n  imgElements.forEach((img) => {\n    if (img.src) {\n      srcList.push(img.src);\n    }\n  });\n\n  return srcList;\n}\n\napp.initializers.add(\n  'yazz-discussionpost',\n  () => {\n    console.log('[yazz/discussionpost] Hello, forum11111!');\n\n    extend(DiscussionListItem.prototype, 'mainItems', function (items) {\n      const discussion = this.attrs.discussion;\n      if (!discussion) {\n        items.add('postimage', <p className=\"PostImage\">discussion属性不存在</p>);\n        return;\n      }\n      const firstPost = discussion.firstPost();\n      if (!firstPost) {\n        items.add('postimage', <p className=\"PostImage\">firstpost为空</p>);\n        return;\n      }\n      const content = firstPost.contentHtml();\n      const imgSrcList = extractImageSrcs(content);\n\n      if (imgSrcList.length == 0) return;\n\n      items.add(\n        'postimage',\n        <p className=\"PostImageWraper\">\n          {imgSrcList.slice(0,5).map((src) => {\n            if (src.includes('assets/files/')) {\n              return <img className='PostImage' src={src} loading=\"lazy\" />;\n            }\n          })}\n        </p>\n      );\n    });\n  },\n  -10\n);\n"],"names":["flarum","core","compat","app","add","console","log","extend","DiscussionListItem","items","discussion","this","attrs","firstPost","htmlString","imgElements","srcList","imgSrcList","contentHtml","DOMParser","parseFromString","querySelectorAll","forEach","img","src","push","length","m","className","slice","map","includes","loading"],"sourceRoot":""}